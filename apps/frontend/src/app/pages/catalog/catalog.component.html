<div class="max-w-4xl mx-auto p-4 space-y-4">
  <header class="flex items-center justify-between gap-3">
    <h1 class="text-xl font-semibold">Каталог книг</h1>
    <nav class="flex gap-3 text-sm underline opacity-80">
      <a routerLink="/catalog">Каталог</a>
      @if(auth.hasToken()){
        <a routerLink="/books/my">Мои книги</a>
        <a routerLink="/deals/my">Мои сделки</a>
        <a routerLink="/deals/incoming">Входящие</a>
        <a routerLink="/profile">Профиль</a>
      } @else {
        <a routerLink="/login">Войти</a>
      }
    </nav>
  </header>

  @if(loading){
    <div class="opacity-70">Загрузка…</div>
  } @else if(error){
    <div class="text-red-600">{{ error }}</div>
  } @else {
    <div class="grid gap-3">
      <div class="rounded-xl border p-4 space-y-2">
      @for(b of books; track b.id) {
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="font-medium">{{ b.title }}</div>
            @if(b.author){
              <div class="text-sm opacity-70">Автор: {{ b.author }}</div>
            }
            @if(b.owner){
              <div class="text-sm opacity-70">Владелец: {{ b.owner.displayName }}</div>
            }
          </div>
          <div class="text-xs px-2 py-1 rounded bg-black/5">
            {{ statusLabel(b.status) }}
          </div>
        </div>

        @if(b.description){
          <div class="text-sm whitespace-pre-wrap opacity-80">{{ b.description }}</div>
        }

        @if(b.owner?.id != auth.userInfo?.id) {
          <div class="flex gap-2">
            <button
              class="px-3 py-2 rounded-lg bg-black text-white disabled:opacity-40"
              [disabled]="b.status !== 'available' || busyId === b.id"
              (click)="createDeal(b)"
            >
              {{ busyId === b.id ? "Создаю…" : "Забрать (сделка)" }}
            </button>
          </div>
        }
      }
      </div>
    </div>
  }
</div>

