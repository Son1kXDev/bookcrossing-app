<div class="max-w-4xl mx-auto p-4 space-y-4">
  <h1 class="text-xl font-semibold">Входящие сделки</h1>

  @if(loading){
    <div class="opacity-70">Загрузка…</div>
  } @else if (error){
    <div class="text-red-600">{{ error }}</div>
  } @else {
    <div class="grid gap-3">
      @for(d of deals; track d.id){
        <div class="rounded-xl border p-4 space-y-2">
          <div class="font-medium">{{ d.book?.title ?? "Книга" }}</div>
          <div class="text-sm opacity-70">Статус: {{ statusLabel(d.status) }}</div>
          @if(d.pickupPointId){
            <div class="text-xs opacity-60">ПВЗ: {{ d.pickupPointId }}</div>
          }

          @if(d.status === 'pending'){
            <div class="flex flex-wrap gap-2">
              <button class="px-3 py-2 rounded-lg bg-black text-white" (click)="accept(d)">Подтвердить</button>
              <button class="px-3 py-2 rounded-lg bg-black/10" (click)="reject(d)">Отклонить</button>
            </div>
          }

          @if(d.status === 'pickup_selected'){
            <div class="space-y-2">
              <label class="block">
                <div class="text-xs opacity-70 mb-1">Трек-номер (можно оставить пустым — будет mock)</div>
                <input class="w-full border rounded-lg px-3 py-2"
                       [(ngModel)]="tracking[d.id]" name="t{{d.id}}" />
              </label>
              <button class="px-3 py-2 rounded-lg bg-black text-white" (click)="ship(d)">
                Подтвердить отправку
              </button>
            </div>
          }

          @if(d.trackingNumber){
            <div class="text-xs opacity-60">Трек: {{ d.trackingNumber }}</div>
          }
        </div>
      }
    </div>
  }
</div>
